<!DOCTYPE html>
<html>
<head>
  <link rel="icon" href="data:,">
  <meta charset="utf-8">
  <title>AR.js + Mid Project</title>

  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.js"></script>

  <style>
    #menu {
      position: absolute;
      top: 50px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 10px;
      color: white;
      font-family: sans-serif;
      z-index: 1000;
    }
    #menu button {
      display: block;
      margin: 5px 0;
      padding: 8px 10px;
      width: 150px;
      background: #2a2a2a;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #menu button:hover {
      background: #444;
    }
  </style>
</head>

<body style="margin: 0; overflow: hidden;">

  <!-- Instructions -->
  <div id="instructions" style="
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    background:rgba(0, 0, 0, 0.7);
    color: white;
    padding: 10px 20px;
    font-family: sans-serif;
    border-radius: 10px;
    z-index: 1000;
    text-align: center;">
    Point your camera at the Hiro marker to see the Village.
  </div>

  <!-- Side Menu -->
  <div id="menu">
    <button onclick="showModel('villageModel')">Village</button>
    <button onclick="showModel('windModel')">Wind Charge</button>
    <button onclick="showModel('geothermalModel')">Geothermal Plant</button>
    <button onclick="showModel('solarModel')">Solar Panel</button>
    <button onclick="showModel('waterModel')">Hydro Energy</button>
    <button onclick="showModel('composterModel')">Composter</button>
    <button onclick="showModel('bagsModel')">Re-usable Bags</button>
  </div>

  <!-- A-Frame Scene -->
  <a-scene embedded arjs="sourceType: webcam;" renderer="antialias: true; logarithmicDepthBuffer: true;" timeout="10000">

    <!-- Lighting -->
    <a-entity light="type: directional; color: #ffffff; intensity: 1.2" position="2 2 1"></a-entity>
    <a-entity light="type: directional; color: #ffaa55; intensity: 0.8" position="-2 2 -1"></a-entity>
    <a-entity light="type: ambient; color: #444444"></a-entity>

    <!-- Assets -->
    <a-assets>
      <a-asset-item id="villageAsset" src="PATH_TO_YOUR_VILLAGE_MODEL.fbx"></a-asset-item>
      <a-asset-item id="windAsset" src="PATH_TO_WIND_MODEL.fbx"></a-asset-item>
      <a-asset-item id="geothermalAsset" src="PATH_TO_GEOTHERMAL_MODEL.fbx"></a-asset-item>
      <a-asset-item id="solarAsset" src="PATH_TO_SOLAR_PANEL_MODEL.fbx"></a-asset-item>
      <a-asset-item id="waterAsset" src="PATH_TO_WATER_MODEL.fbx"></a-asset-item>
      <a-asset-item id="composterAsset" src="PATH_TO_COMPOSTER_MODEL.fbx"></a-asset-item>
      <a-asset-item id="bagsAsset" src="paper_bag(1).fbx"></a-asset-item>
    </a-assets>

    <!-- Marker -->
    <a-marker preset="hiro" id="hiroMarker">
      <a-entity id="rotator" rotation="0 0 0"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 60000; easing: linear;">
        
        <!-- Models -->
        <a-entity id="villageModel" fbx-model="#villageAsset" scale="0.05 0.05 0.05" visible="true" touch-scale="true" touch-rotate="true"></a-entity>
        <a-entity id="windModel" fbx-model="#windAsset" scale="0.05 0.05 0.05" visible="false" touch-scale="true" touch-rotate="true"></a-entity>
        <a-entity id="geothermalModel" fbx-model="#geothermalAsset" scale="0.05 0.05 0.05" visible="false" touch-scale="true" touch-rotate="true"></a-entity>
        <a-entity id="solarModel" fbx-model="#solarAsset" scale="0.05 0.05 0.05" visible="false" touch-scale="true" touch-rotate="true"></a-entity>
        <a-entity id="waterModel" fbx-model="#waterAsset" scale="0.05 0.05 0.05" visible="false" touch-scale="true" touch-rotate="true"></a-entity>
        <a-entity id="composterModel" fbx-model="#composterAsset" scale="0.05 0.05 0.05" visible="false" touch-scale="true" touch-rotate="true"></a-entity>
        <a-entity id="bagsModel" fbx-model="#bagsAsset" scale="0.05 0.05 0.05" visible="false" touch-scale="true" touch-rotate="true"></a-entity>

      </a-entity>
    </a-marker>

    <!-- Camera -->
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const instructions = document.getElementById("instructions");
    const marker = document.getElementById("hiroMarker");

    marker.addEventListener("markerFound", () => {
      instructions.style.display = "none";
    });

    marker.addEventListener("markerLost", () => {
      instructions.style.display = "block";
    });

    // Switching Models
    function showModel(modelId) {
      const models = [
        'villageModel', 'windModel', 'geothermalModel',
        'solarModel', 'waterModel', 'composterModel', 'bagsModel'
      ];
      models.forEach(id => {
        const model = document.getElementById(id);
        if (model) {
          model.setAttribute('visible', id === modelId);
        }
      });
    }

    // Touch Scaling and Rotating Logic
    AFRAME.registerComponent('touch-scale', {
      init: function () {
        this.scaleStart = 1;
        this.scaleFactor = 1;
        this.el.addEventListener('touchstart', this.onTouchStart.bind(this));
        this.el.addEventListener('touchmove', this.onTouchMove.bind(this));
        this.el.addEventListener('touchend', this.onTouchEnd.bind(this));
      },

      onTouchStart: function (event) {
        if (event.touches.length === 2) {
          this.scaleStart = this.calculateDistance(event.touches[0], event.touches[1]);
        }
      },

      onTouchMove: function (event) {
        if (event.touches.length === 2) {
          const scaleEnd = this.calculateDistance(event.touches[0], event.touches[1]);
          this.scaleFactor = scaleEnd / this.scaleStart;
          this.el.setAttribute('scale', {
            x: this.scaleFactor,
            y: this.scaleFactor,
            z: this.scaleFactor
          });
        }
      },

      onTouchEnd: function () {
        this.scaleStart = 1;
        this.scaleFactor = 1;
      },

      calculateDistance: function (touch1, touch2) {
        const dx = touch2.pageX - touch1.pageX;
        const dy = touch2.pageY - touch1.pageY;
        return Math.sqrt(dx * dx + dy * dy);
      }
    });

    // Rotation on Scroll
    AFRAME.registerComponent('touch-rotate', {
      init: function () {
        this.lastY = null;
        this.rotationSpeed = 0.5;

        this.el.addEventListener('touchmove', this.onTouchMove.bind(this));
      },

      onTouchMove: function (event) {
        if (event.touches.length === 1) {
          const touch = event.touches[0];
          if (this.lastY !== null) {
            const deltaY = touch.pageY - this.lastY;
            const rotation = this.el.getAttribute('rotation');
            rotation.y += deltaY * this.rotationSpeed;
            this.el.setAttribute('rotation', rotation);
          }
          this.lastY = touch.pageY;
        }
      }
    });
  </script>

</body>
</html>
